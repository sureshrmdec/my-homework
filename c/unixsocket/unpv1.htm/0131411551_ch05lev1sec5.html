<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="5.5 TCP Echo Client: 'str_cli' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch05lev1sec4.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch05lev1sec6.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch05lev1sec5"></A>
<H3 class="docSection1Title" id="162666-876">5.5 TCP Echo Client: <TT>str_cli</TT> Function</H3>
<P class="docText">This function, shown in <A class="docLink" HREF="#ch05fig05">Figure 5.5</A>, handles the client processing loop: It reads a line of text from standard input, writes it to the server, reads back the server's echo of the line, and outputs the echoed line to standard output.</P>

<H5 class="docExampleTitle"><A NAME="ch05fig05"></A>Figure 5.5 <TT>str_cli</TT> function: client processing loop.</H5>
<P class="docText"><span class="docEmphasis">lib/str_cli.c</span></P>

<PRE>
 1 #include    "unp.h"

 2 void
 3 str_cli(FILE *fp, int sockfd)
 4 {
 5     char    sendline[MAXLINE], recvline[MAXLINE];

 6     while (Fgets(sendline, MAXLINE, fp) != NULL) {

 7         Writen(sockfd, sendline, strlen (sendline));

 8         if (Readline(sockfd, recvline, MAXLINE) == 0)
 9             err_quit("str_cli: server terminated prematurely");

10         Fputs(recvline, stdout);
11     }
12 }
</PRE>

<A NAME="ch05lev3sec7"></A>
<H4 class="docSection2Title"> Read a line, write to server</H4>
<p class="docText"><span class="docEmphasis"><TT>6–7</TT></span> <TT>fgets</TT> reads a line of text and <TT>writen</TT> sends the line to the server.</p>

<A NAME="ch05lev3sec8"></A>
<H4 class="docSection2Title"> Read echoed line from server, write to standard output</H4>
<p class="docText"><span class="docEmphasis"><TT>8–10</TT></span> <TT>readline</TT> reads the line echoed back from the server and <TT>fputs</TT> writes it to standard output.</p>

<A NAME="ch05lev3sec9"></A>
<H4 class="docSection2Title"> Return to <TT>main</TT></H4>
<p class="docText"><span class="docEmphasis"><TT>11–12</TT></span> The loop terminates when <TT>fgets</TT> returns a null pointer, which occurs when it encounters either an end-of-file (EOF) or an error. Our <TT>Fgets</TT> wrapper function checks for an error and aborts if one occurs, so <TT>Fgets</TT> returns a null pointer only when an end-of-file is encountered.</p>


<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch05lev1sec4.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch05lev1sec6.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
