<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="11.15 'udp_connect' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch11lev1sec14.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch11lev1sec16.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch11lev1sec15"></A>
<H3 class="docSection1Title">11.15 <TT>udp_connect</TT> Function</H3>
<P class="docText">Our <TT>udp_connect</TT> function creates a connected UDP socket.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include "unp.h"</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int udp_connect (const char</TT> *<span class="docEmphasis">hostname</span>, <TT>const char</TT> *<span class="docEmphasis">service</span>);</P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">Returns: connected socket descriptor if OK, no return on error</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">With a connected UDP socket, the final two arguments required by <TT>udp_client</TT> are no longer needed. The caller can call <TT>write</TT> instead of <TT>sendto</TT>, so our function need not return a socket address structure and its length.</P>
<P class="docText"><A class="docLink" HREF="#ch11fig17">Figure 11.17</A> shows the source code.</P>

<H5 class="docExampleTitle"><A NAME="ch11fig17"></A>Figure 11.17 <TT>udp_connect</TT> function: creates a connected UDP socket.</H5>
<P class="docText"><span class="docEmphasis">lib/udp_connect.c</span></P>

<PRE>
 1 #include     "unp.h"

 2 int
 3 udp_connect (const char *host, const char *serv)
 4 {
 5     int     sockfd, n;
 6     struct addrinfo hints, *res, *ressave;

 7     bzero (&amp;hints, sizeof (struct addrinfo));
 8     hints.ai_family = AF_UNSPEC;
 9     hints.ai_socktype = SOCK_DGRAM;

10     if ( (n = getaddrinfo (host, serv, &amp;hints, &amp;res)) != 0)
11         err_quit ("udp_connect error for %s, %s: %s",
12                  host, serv, gai_strerror (n));
13     ressave = res;

14     do {
15         sockfd = socket (res-&gt;ai_family, res-&gt;ai_socktype, res-&gt;ai_protocol);
16         if (sockfd &lt; 0)
17             continue;         /* ignore this one */

18         if (connect (sockfd, res-&gt;ai_addr, res-&gt;ai_addrlen) == 0)
19             break;            /* success */

20         Close (sockfd);       /* ignore this one */
21     } while ( (res = res-&gt;ai_next) ! = NULL);

22     if (res == NULL)          /* errno set from final connect () */
23         err_sys ("udp_connect error for %s, %s", host, serv);

24     freeaddrinfo (ressave);

25     return (sockfd);
26 }
</PRE>

<P class="docText">This function is nearly identical to <TT>tcp_connect</TT>. One difference, however, is that the call to <TT>connect</TT> with a UDP socket does not send anything to the peer. If something is wrong (the peer is unreachable or there is no server at the specified port), the caller does not discover that until it sends a datagram to the peer.</P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch11lev1sec14.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch11lev1sec16.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
