<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="28.2 Raw Socket Creation"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch28lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch28lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch28lev1sec2"></A>
<H3 class="docSection1Title" id="162666-918">28.2 Raw Socket Creation</H3>
<P class="docText">The steps involved in creating a raw socket are as follows:</P>
<A NAME="ch28pro01"></A>




<span style="font-weight:bold"><OL class="docList" START="1"><LI><span style="font-weight:normal" value="1"><P class="docList">The <TT>socket</TT> function creates a raw socket when the second argument is <TT>SOCK_RAW</TT>. The third argument (the protocol) is normally nonzero. For example, to create an IPv4 raw socket we would write</P>
<pre>

</pre><pre>
int     sockfd;

sockfd = socket(AF_INET, SOCK_RAW, <span class="docEmphasis">protocol</span>);
</pre><pre>
</pre>
<P class="docList">where <span class="docEmphasis">protocol</span> is one of the constants, <TT>IPPROTO</TT>_<span class="docEmphasis">xxx</span>, defined by including the <TT>&lt;netinet/in.h&gt;</TT> header, such as <TT>IPPROTO_ICMP</TT>.</P>
<P class="docText">Only the superuser can create a raw socket. This prevents normal users from writing their own IP datagrams to the network.</P>
</span></LI><LI><span style="font-weight:normal" value="2"><P class="docList">The <TT>IP_HDRINCL</TT> socket option can be set as follows:</P>
<pre>

</pre><pre>
const int on = 1;

if (setsockopt(sockfd, IPPROTO_IP, IP_HDRINCL, &amp;on, sizeof(on)) &lt; 0)
    <span class="docEmphasis">error</span>
</pre><pre>
</pre>
<P class="docText">We will describe the effect of this socket option in the next section.</P>
</span></LI><LI><span style="font-weight:normal" value="3"><P class="docText"><TT>bind</TT> can be called on the raw socket, but this is rare. This function sets only the local address: There is no concept of a port number with a raw socket. With regard to output, calling <TT>bind</TT> sets the source IP address that will be used for datagrams sent on the raw socket (but only if the <TT>IP_HDRINCL</TT> socket option is not set). If <TT>bind</TT> is not called, the kernel sets the source IP address to the primary IP address of the outgoing interface.</P>
</span></LI><LI><span style="font-weight:normal" value="4"><P class="docText"><TT>connect</TT> can be called on the raw socket, but this is rare. This function sets only the foreign address: Again, there is no concept of a port number with a raw socket. With regard to output, calling <TT>connect</TT> lets us call <TT>write</TT> or <TT>send</TT> instead of <TT>sendto</TT>, since the destination IP address is already specified.</P>
</span></LI></OL></span>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch28lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch28lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
