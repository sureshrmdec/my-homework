<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="A.2 IPv4 Header"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_app01lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_app01lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="app01lev1sec2"></A>
<H3 class="docSection1Title">A.2 IPv4 Header</H3>
<P class="docText">The IP layer provides a connectionless best-effort datagram delivery service (RFC 791 [Postel 1981a]). IP makes its best effort to deliver an IP datagram to the specified destination, but there is no guarantee that the datagram will arrive, will arrive in order relative to other packets, or will arrive only once. Any desired reliability, ordering, and duplicate suppression must be added by the upper layers. In the case of a TCP or SCTP application, this is performed by the transport layer. In the case of a UDP application, this must be done by the application since UDP is unreliable; we show an example of this in <A class="docLink" HREF="0131411551_ch22lev1sec5.html#ch22lev1sec5">Section 22.5</A>.</P>
<P class="docText">One of the most important functions of the IP layer is <span class="docEmphasis">routing</span>. Every IP datagram contains a source and destination address. <A class="docLink" HREF="#app01fig01">Figure A.1</A> shows the format of an IPv4 header.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="app01fig01"></A>Figure A.1. Format of the IPv4 header.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="500" HEIGHT="318" src="FILES/xafig01.gif" ALT="graphics/xafig01.gif"></p>

</CENTER>
<UL><LI><P class="docList">The 4-bit <span class="docEmphasis">version</span> field is 4. This has been the version of IP in use since the early 1980s.</P></LI><LI><P class="docList">The <span class="docEmphasis">header length</span> field is the length of the entire IP header, including any options, in whole 32-bit words. The maximum value for this 4-bit field is 15 (<TT>0xf</TT>), giving a maximum IP header length of 60 bytes. Therefore, with the fixed portion of the header occupying 20 bytes, this allows for up to 40 bytes of options.</P></LI><LI><P class="docList">The 6-bit <span class="docEmphasis">Differentiated Services Code Point</span> (DSCP) field (RFC 2474 [Nichols et al. 1998]) and the 2-bit <span class="docEmphasis">Explicit Congestion Notification</span> (ECN) field (RFC 3168 [Ramakrishnan, Floyd, and Black 2001]) replace the historical 8-bit <span class="docEmphasis">type-of-service</span> (TOS) field, which was described in RFC 1349 [Almquist 1992]. We can set all 8 bits of this field with the <TT>IP_TOS</TT> socket option (<A class="docLink" HREF="0131411551_ch07lev1sec6.html#ch07lev1sec6">Section 7.6</A>), although the kernel may overwrite any value we set to enforce Diffserv policy or implement ECN.</P></LI><LI><P class="docList">The 16-bit <span class="docEmphasis">total length</span> field is the total length in bytes of the IP datagram, including the IPv4 header. The amount of data in the datagram is this field minus 4 times the header length (recall that the header length is in units of whole 32-bit words, or 4 bytes). This field is required because some datalinks pad the frame to some minimum length (e.g., Ethernet) and it is possible for the size of a valid IP datagram to be less than the datalink minimum.</P></LI><LI><P class="docList">The 16-bit <span class="docEmphasis">identification</span> field is set to a different value for each IP datagram and enables fragmentation and reassembly (<A class="docLink" HREF="0131411551_ch02lev1sec11.html#ch02lev1sec11">Section 2.11</A>). The value must be unique for the packet's source, destination, and protocol, for the length of time that the datagram could be in transit. If there is no chance that the packet will be fragmented, for instance, the <span class="docEmphasis">DF</span> bit is set, there is no need to set this field.</P></LI><LI><P class="docList">The <span class="docEmphasis">DF</span> (don't fragment) bit, the <span class="docEmphasis">MF</span> (more fragments) bit, and the 13-bit <span class="docEmphasis">fragment offset</span> field are also used with fragmentation and reassembly. The <span class="docEmphasis">DF</span> bit is also used with path MTU discovery (<A class="docLink" HREF="0131411551_ch02lev1sec11.html#ch02lev1sec11">Section 2.11</A>).</P></LI><LI><P class="docList">The 8-bit <span class="docEmphasis">time-to-live</span> (TTL) field is set by the sender and then decremented by 1 each time a router forwards the datagram. The datagram is discarded by any router that decrements the value to 0. This limits the lifetime of any IP datagram to 255 hops. A common default for this field is 64, but we can query and change this default with the <TT>IP_TTL</TT> and <TT>IP_MULTICAST_TTL</TT> socket options (<A class="docLink" HREF="0131411551_ch07lev1sec6.html#ch07lev1sec6">Section 7.6</A>).</P></LI><LI><P class="docList">The 8-bit <span class="docEmphasis">protocol</span> field specifies the next layer protocol contained in the IP datagram. Typical values are 1 (ICMPv4), 2 (IGMPv4), 6 (TCP), and 17 (UDP). These values are specified in the IANA's "Protocol Numbers" registry [IANA].</P></LI><LI><P class="docList">The 16-bit <span class="docEmphasis">header checksum</span> is calculated over just the IP header (including any options). The algorithm is the standard Internet checksum algorithm, a simple 16-bit one's-complement addition, which we show in <A class="docLink" HREF="0131411551_ch28lev1sec5.html#ch28fig15">Figure 28.15</A>.</P></LI><LI><P class="docList">The <span class="docEmphasis">source IPv4 address</span> and the <span class="docEmphasis">destination IPv4 address</span> are both 32-bit fields.</P></LI><LI><P class="docList">We describe the <span class="docEmphasis">options</span> field in <A class="docLink" HREF="0131411551_ch27lev1sec2.html#ch27lev1sec2">Section 27.2</A> and show an example of the IPv4 source route option in <A class="docLink" HREF="0131411551_ch27lev1sec3.html#ch27lev1sec3">Section 27.3</A>.</P></LI></UL>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_app01lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_app01lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
