<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="8.3 UDP Echo Server: 'main' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch08lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch08lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch08lev1sec3"></A>
<H3 class="docSection1Title">8.3 UDP Echo Server: <TT>main</TT> Function</H3>
<P class="docText">We will now redo our simple echo client/server from <A class="docLink" HREF="0131411551_ch05.html#ch05">Chapter 5</A> using UDP. Our UDP client and server programs follow the function call flow that we diagrammed in <A class="docLink" HREF="0131411551_ch08lev1sec1.html#ch08fig01">Figure 8.1</A>. <A class="docLink" HREF="#ch08fig02">Figure 8.2</A> depicts the functions that are used. <A class="docLink" HREF="#ch08fig03">Figure 8.3</A> shows the server <TT>main</TT> function.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch08fig02"></A>Figure 8.2. Simple echo client/server using UDP.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="471" HEIGHT="83" src="FILES/08fig02.gif" ALT="graphics/08fig02.gif"></p>

</CENTER>

<H5 class="docExampleTitle"><A NAME="ch08fig03"></A>Figure 8.3 UDP echo server.</H5>
<P class="docText"><span class="docEmphasis">udpcliserv/udpserv01.c</span></P>

<PRE>
 1 #include     "unp.h"

 2 int
 3 main(int argc, char **argv)
 4 {
 5     int     sockfd;
 6     struct sockaddr_in servaddr, cliaddr;

 7     sockfd = Socket(AF_INET, SOCK_DGRAM, 0);

 8     bzero(&amp;servaddr, sizeof(servaddr));
 9     servaddr.sin_family = AF_INET;
10     servaddr.sin_addr.s_addr = htonl(INADDR_ANY);
11     servaddr.sin_port = htons(SERV_PORT);

12     Bind(sockfd, (SA *) &amp;servaddr, sizeof(servaddr));

13     dg_echo(sockfd, (SA *) &amp;cliaddr, sizeof(cliaddr));
14 }
</PRE>

<A NAME="ch08lev3sec1"></A>
<H4 class="docSection2Title"> Create UDP socket, bind server's well-known port</H4>
<p class="docText"><span class="docEmphasis"><TT>7–12</TT></span> We create a UDP socket by specifying the second argument to <TT>socket</TT> as <TT>SOCK_DGRAM</TT> (a datagram socket in the IPv4 protocol). As with the TCP server example, the IPv4 address for the <TT>bind</TT> is specified as <TT>INADDR_ANY</TT> and the server's well-known port is the constant <TT>SERV_PORT</TT> from the <TT>unp.h</TT> header.</p>
<p class="docText"><span class="docEmphasis"><TT>13</TT></span> The function <TT>dg_echo</TT> is called to perform server processing.</p>


<a href="0131411551_23961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch08lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch08lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
