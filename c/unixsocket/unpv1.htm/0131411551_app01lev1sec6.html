<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="A.6 Internet Control Message Protocols (ICMPv4 and ICMPv6)"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_app01lev1sec5.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_app02.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="app01lev1sec6"></A>
<H3 class="docSection1Title">A.6 Internet Control Message Protocols (ICMPv4 and ICMPv6)</H3>
<P class="docText">ICMP is a required and integral part of any IPv4 or IPv6 implementation. ICMP is normally used to communicate error or informational messages between IP nodes, both routers and hosts, but it is occasionally used by applications. The <TT>ping</TT> and <TT>traceroute</TT> applications (<A class="docLink" HREF="0131411551_ch28.html#ch28">Chapter 28</A>), for example, both use ICMP.</P>
<P class="docText">The first 32 bits of both ICMPv4 and ICMPv6 messages are the same and are shown in <A class="docLink" HREF="#app01fig14">Figure A.14</A>. RFC 792 [Postel 1981b] documents ICMPv4 and RFC 2463 [Conta and Deering 1998] documents ICMPv6.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="app01fig14"></A>Figure A.14. Format of ICMPv4 and ICMPv6 messages.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="473" HEIGHT="154" src="FILES/xafig14.gif" ALT="graphics/xafig14.gif"></p>

</CENTER>
<P class="docText">The 8-bit <span class="docEmphasis">type</span> is the type of the ICMPv4 or ICMPv6 message and some types have an 8-bit <span class="docEmphasis">code</span> with additional information. The <span class="docEmphasis">checksum</span> is the standard Internet checksum, although in ICMPv4, the checksum covers only the ICMP payload starting with the type field, while the ICMPv6 checksum also includes the IPv6 pseudoheader.</P>
<P class="docText">From a network programming perspective, we need to understand which ICMP messages can be returned to an application, what causes an error, and how an error is returned to the application. <A class="docLink" HREF="#app01fig15">Figure A.15</A> lists all the ICMPv4 messages and how they are handled by FreeBSD. <A class="docLink" HREF="#app01fig16">Figure A.16</A> lists the ICMPv6 messages. The third column indicates the <TT>errno</TT> value returned by those messages that trigger an error to be returned to the application. When using TCP, the error is noted but is not immediately returned. If TCP later gives up on the connection due to a timeout, any ICMP error indication is then returned. When using UDP, the next send or receive operation receives the error, but only when using a connected socket, as described in <A class="docLink" HREF="0131411551_ch08lev1sec9.html#ch08lev1sec9">Section 8.9</A>.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="app01fig15"></A>Figure A.15. Handling of the ICMP message types by FreeBSD.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="500" HEIGHT="545" src="FILES/xafig15.gif" ALT="graphics/xafig15.gif"></p>

</CENTER>
<P class="docText">*-"port unreachable" is only used by transport protocols that do not have their own mechanism for signalling that no process is listening on a port. For example, TCP sends an RST message so it does not need the "port unreachable" message.</P>
<P class="docText"><img src="FILES/U2020.GIF" border=0>-redirects are ignored by systems acting as routers by forwarding packets.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="app01fig16"></A>Figure A.16. ICMPv6 messages.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="500" HEIGHT="367" src="FILES/xafig16.gif" ALT="graphics/xafig16.gif"></p>

</CENTER>
<P class="docText">**-"RFC2463bis" designates the revision in progress of RFC 2463—[Conta and Deering 2001].</P>
<P class="docText">The notation "user process" means that the kernel does not process the message and it is up to a user process with a raw socket to handle the message. No error return is triggered for these messages. We must also note that different implementations may handle certain messages differently. For example, although Unix systems normally handle router solicitations and router advertisements in a user process, other implementations might handle these messages in the kernel.</P>
<P class="docText">ICMPv6 clears the high-order bit of the <span class="docEmphasis">type</span> field for the error messages (<span class="docEmphasis">types</span> 1–4) and sets this bit for the informational messages (<span class="docEmphasis">types</span> 128–137).</P>

<a href="0131411551_23961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_app01lev1sec5.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_app02.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
