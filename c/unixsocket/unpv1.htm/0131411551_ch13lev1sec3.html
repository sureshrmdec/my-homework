<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="13.3 'syslog' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch13lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch13lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch13lev1sec3"></A>
<H3 class="docSection1Title">13.3 <TT>syslog</TT> Function</H3>
<P class="docText">Since a daemon does not have a controlling terminal, it cannot just <TT>fprintf</TT> to <TT>stderr</TT>. The common technique for logging messages from a daemon is to call the <TT>syslog</TT> function.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;syslog.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>void syslog(int</TT> <span class="docEmphasis">priority</span>, <TT>const char *</TT><span class="docEmphasis">message</span>, <TT>... );</TT></P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">Although this function was originally developed for BSD systems, it is provided by virtually all Unix vendors today. The description of <TT>syslog</TT> in the POSIX specification is consistent with what we describe here. RFC 3164 provides documentation of the BSD syslog protocol.</P>
<P class="docText">The <span class="docEmphasis">priority</span> argument is a combination of a <span class="docEmphasis">level</span> and a <span class="docEmphasis">facility</span>, which we show in <A class="docLink" HREF="#ch13fig01">Figures 13.1</A> and <A class="docLink" HREF="#ch13fig02">13.2</A>. Additional detail on the <span class="docEmphasis">priority</span> may be found in RFC 3164. The <span class="docEmphasis">message</span> is like a format string to <TT>printf</TT>, with the addition of a <TT>%m</TT> specification, which is replaced with the error message corresponding to the current value of <TT>errno</TT>. A newline can appear at the end of the <span class="docEmphasis">message</span>, but is not mandatory.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch13fig01"></A>Figure 13.1. <span class="docEmphasis">level</span> of log messages.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="445" HEIGHT="170" src="FILES/13fig01.gif" ALT="graphics/13fig01.gif"></p>

</CENTER>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch13fig02"></A>Figure 13.2. <span class="docEmphasis">facility</span> of log messages.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="405" HEIGHT="378" src="FILES/13fig02.gif" ALT="graphics/13fig02.gif"></p>

</CENTER>
<P class="docText">Log messages have a <span class="docEmphasis">level</span> between 0 and 7, which we show in <A class="docLink" HREF="#ch13fig01">Figure 13.1</A>. These are ordered values. If no <span class="docEmphasis">level</span> is specified by the sender, <TT>LOG_NOTICE</TT> is the default.</P>
<P class="docText">Log messages also contain a <span class="docEmphasis">facility</span> to identify the type of process sending the message. We show the different values in <A class="docLink" HREF="#ch13fig02">Figure 13.2</A>. If no <span class="docEmphasis">facility</span> is specified, <TT>LOG_USER</TT> is the default.</P>
<P class="docText">For example, the following call could be issued by a daemon when a call to the <TT>rename</TT> function unexpectedly fails:</P>
<pre>

</pre><pre>
syslog(LOG_INFO|LOG_LOCAL2, "rename(%s, %s): %m", file1, file2);
</pre><pre>
</pre>
<P class="docText">The purpose of <span class="docEmphasis">facility</span> and <span class="docEmphasis">level</span> is to allow all messages from a given facility to be handled the same in the <TT>/etc/syslog.conf</TT> file, or to allow all messages of a given level to be handled the same. For example, the configuration file could contain the lines</P>
<pre>

</pre><pre>
kern.*           /dev/console
local7.debug     /var/log/cisco.log
</pre><pre>
</pre>
<P class="docText">to specify that all kernel messages get logged to the console and all <TT>debug</TT> messages from the <TT>local7</TT> facility get appended to the file <TT>/var/log/cisco.log</TT>.</P>
<P class="docText">When the application calls <TT>syslog</TT> the first time, it creates a Unix domain datagram socket and then calls <TT>connect</TT> to the well-known pathname of the socket created by the <TT>syslogd</TT> daemon (e.g., <TT>/var/run/log</TT>). This socket remains open until the process terminates. Alternately, the process can call <TT>openlog</TT> and <TT>closelog</TT>.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;syslog.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>void openlog(const char</TT> <span class="docEmphasis">*ident</span>, <TT>int</TT> <span class="docEmphasis">options</span>, <TT>int</TT> <span class="docEmphasis">facility</span><TT>);</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>void closelog(void);</TT></P></TD></TR></COLGROUP></TABLE></P>
<P class="docText"><TT>openlog</TT> can be called before the first call to <TT>syslog</TT> and <TT>closelog</TT> can be called when the application is finished sending log messages.</P>
<P class="docText"><span class="docEmphasis">ident</span> is a string that will be prepended to each log message by <TT>syslog</TT>. Often this is the program name.</P>
<P class="docText">The <span class="docEmphasis">options</span> argument is formed as the logical OR of one or more of the constants in <A class="docLink" HREF="#ch13fig03">Figure 13.3</A>.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch13fig03"></A>Figure 13.3. <span class="docEmphasis">options</span> for <TT>openlog</TT>.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="498" HEIGHT="101" src="FILES/13fig03.gif" ALT="graphics/13fig03.gif"></p>

</CENTER>
<P class="docText">Normally the Unix domain socket is not created when <TT>openlog</TT> is called. Instead, it is opened during the first call to <TT>syslog</TT>. The <TT>LOG_NDELAY</TT> option causes the socket to be created when <TT>openlog</TT> is called.</P>
<P class="docText">The <span class="docEmphasis">facility</span> argument to <TT>openlog</TT> specifies a default facility for any subsequent calls to <TT>syslog</TT> that do not specify a facility. Some daemons call <TT>openlog</TT> and specify the facility (which normally does not change for a given daemon). They then specify only the <span class="docEmphasis">level</span> in each call to <TT>syslog</TT> (since the <span class="docEmphasis">level</span> can change depending on the error).</P>
<P class="docText">Log messages can also be generated by the <TT>logger</TT> command. This can be used from within shell scripts, for example, to send messages to <TT>syslogd</TT>.</P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch13lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch13lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
