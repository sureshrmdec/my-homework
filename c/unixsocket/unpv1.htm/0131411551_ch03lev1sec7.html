<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="3.7 'inet_pton' and 'inet_ntop' Functions"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch03lev1sec6.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch03lev1sec8.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch03lev1sec7"></A>
<H3 class="docSection1Title">3.7 <TT>inet_pton</TT> and <TT>inet_ntop</TT> Functions</H3>
<P class="docText">These two functions are new with IPv6 and work with both IPv4 and IPv6 addresses. We use these two functions throughout the text. The letters "<TT>p</TT>" and "<TT>n</TT>" stand for <span class="docEmphasis">presentation</span> and <span class="docEmphasis">numeric</span>. The presentation format for an address is often an ASCII string and the numeric format is the binary value that goes into a socket address structure.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;arpa/inet.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int inet_pton(int</TT> <span class="docEmphasis">family</span>, <TT>const char *</TT><span class="docEmphasis">strptr</span>, <TT>void *</TT><span class="docEmphasis">addrptr</span><TT>);</TT></P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">Returns: 1 if OK, 0 if input not a valid presentation format, -1 on error</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>const char *inet_ntop(int</TT> <span class="docEmphasis">family</span>, <TT>const void *</TT><span class="docEmphasis">addrptr</span>, <TT>char *</TT><span class="docEmphasis">strptr</span>, <TT>size_t</TT> <span class="docEmphasis">len</span><TT>);</TT></P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">Returns: pointer to result if OK, <TT>NULL</TT> on error</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">The <span class="docEmphasis">family</span> argument for both functions is either <TT>AF_INET</TT> or <TT>AF_INET6</TT>. If <span class="docEmphasis">family</span> is not supported, both functions return an error with <TT>errno</TT> set to <TT>EAFNOSUPPORT</TT>.</P>
<P class="docText">The first function tries to convert the string pointed to by <span class="docEmphasis">strptr</span>, storing the binary result through the pointer <span class="docEmphasis">addrptr</span>. If successful, the return value is 1. If the input string is not a valid presentation format for the specified <span class="docEmphasis">family</span>, 0 is returned.</P>
<P class="docText"><TT>inet_ntop</TT> does the reverse conversion, from numeric (<span class="docEmphasis">addrptr</span>) to presentation (<span class="docEmphasis">strptr</span>). The <span class="docEmphasis">len</span> argument is the size of the destination, to prevent the function from overflowing the caller's buffer. To help specify this size, the following two definitions are defined by including the <TT>&lt;netinet/in.h&gt;</TT> header:</P>
<pre>

</pre><pre>
#define INET_ADDRSTRLEN       16       /* for IPv4 dotted-decimal */
#define INET6_ADDRSTRLEN      46       /* for IPv6 hex string */
</pre><pre>
</pre>
<P class="docText">If <span class="docEmphasis">len</span> is too small to hold the resulting presentation format, including the terminating null, a null pointer is returned and <TT>errno</TT> is set to <TT>ENOSPC</TT>.</P>
<P class="docText">The <span class="docEmphasis">strptr</span> argument to <TT>inet_ntop</TT> cannot be a null pointer. The caller must allocate memory for the destination and specify its size. On success, this pointer is the return value of the function.</P>
<P class="docText"><A class="docLink" HREF="#ch03fig11">Figure 3.11</A> summarizes the five functions that we have described in this section and the previous section.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch03fig11"></A>Figure 3.11. Summary of address conversion functions.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="500" HEIGHT="319" src="FILES/03fig11.gif" ALT="graphics/03fig11.gif"></p>

</CENTER>
<A NAME="ch03lev2sec6"></A>
<H4 class="docSection2Title"> Example</H4>
<P class="docText">Even if your system does not yet include support for IPv6, you can start using these newer functions by replacing calls of the form</P>
<pre>

</pre><pre>
foo.sin_addr.s_addr = inet_addr(cp);
</pre><pre>
</pre>
<P class="docText">with</P>
<pre>

</pre><pre>
inet_pton(AF_INET, cp, &amp;foo.sin_addr);
</pre><pre>
</pre>
<P class="docText">and replacing calls of the form</P>
<pre>

</pre><pre>
ptr = inet_ntoa(foo.sin_addr);
</pre><pre>
</pre>
<P class="docText">with</P>
<pre>

</pre><pre>
char str[INET_ADDRSTRLEN];
ptr = inet_ntop(AF_INET, &amp;foo.sin_addr, str, sizeof(str));
</pre><pre>
</pre>
<P class="docText"><A class="docLink" HREF="#ch03fig12">Figure 3.12</A> shows a simple definition of <TT>inet_pton</TT> that supports only IPv4. Similarly, <A class="docLink" HREF="#ch03fig13">Figure 3.13</A> shows a simple version of <TT>inet_ntop</TT> that supports only IPv4.</P>

<H5 class="docExampleTitle"><A NAME="ch03fig12"></A>Figure 3.12 Simple version of <TT>inet_pton</TT> that supports only IPv4.</H5>
<P class="docText"><span class="docEmphasis">libfree/inet_pton_ipv4.c</span></P>

<PRE>
10 int
11 inet_pton(int family, const char *strptr, void *addrptr)
12 {
13     if (family == AF_INET) {
14         struct in_addr in_val;

15         if (inet_aton(strptr, &amp;in_val)) {
16             memcpy(addrptr, &amp;in_val, sizeof(struct in_addr));
17             return (1);
18         }
19         return (0);
20     }
21     errno = EAFNOSUPPORT;
22     return (-1);
23 }
</PRE>


<H5 class="docExampleTitle"><A NAME="ch03fig13"></A>Figure 3.13 Simple version of <TT>inet_ntop</TT> that supports only IPv4.</H5>
<P class="docText"><span class="docEmphasis">libfree/inet_ntop_ipv4.c</span></P>

<PRE>
 8 const char *
 9 inet_ntop(int family, const void *addrptr, char *strptr, size_t len)
10 {
11     const u_char *p = (const u_char *) addrptr;

12     if (family == AF_INET) {
13         char    temp[INET_ADDRSTRLEN];

14         snprintf(temp, sizeof(temp), "%d.%d.%d.%d", p[0], p[1], p[2], p[3]);
15         if (strlen(temp) &gt;= len) {
16             errno = ENOSPC;
17             return (NULL);
18         }
19         strcpy(strptr, temp);
20         return (strptr);
21     }
22     errno = EAFNOSUPPORT;
23     return (NULL);
24 }
</PRE>



<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch03lev1sec6.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch03lev1sec8.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
