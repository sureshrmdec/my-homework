<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="11.17 'getnameinfo' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch11lev1sec16.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch11lev1sec18.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch11lev1sec17"></A>
<H3 class="docSection1Title">11.17 <TT>getnameinfo</TT> Function</H3>
<P class="docText">This function is the complement of <TT>getaddrinfo</TT>: It takes a socket address and returns a character string describing the host and another character string describing the service. This function provides this information in a protocol-independent fashion; that is, the caller does not care what type of protocol address is contained in the socket address structure, as that detail is handled by the function.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;netdb.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int getnameinfo (const struct sockaddr</TT> *<span class="docEmphasis">sockaddr</span>, <TT>socklen_t</TT> <span class="docEmphasis">addrlen</span>, <TT>char</TT> *<span class="docEmphasis">host</span>, <TT>socklen_t</TT> <span class="docEmphasis">hostlen</span>, <TT>char</TT> *<span class="docEmphasis">serv</span>, <TT>socklen_t</TT> <span class="docEmphasis">servlen</span>, <TT>int</TT> <span class="docEmphasis">flags</span>) ;</P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">Returns: 0 if OK, nonzero on error (see <A class="docLink" HREF="0131411551_ch11lev1sec7.html#ch11fig07">Figure 11.7</A>)</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText"><span class="docEmphasis">sockaddr</span> points to the socket address structure containing the protocol address to be converted into a human-readable string, and <span class="docEmphasis">addrlen</span> is the length of this structure. This structure and its length are normally returned by <TT>accept</TT>, <TT>recvfrom</TT>, <TT>getsockname</TT>, or <TT>getpeername</TT>.</P>
<P class="docText">The caller allocates space for the two human-readable strings: <span class="docEmphasis">host</span> and <span class="docEmphasis">hostlen</span> specify the host string, and <span class="docEmphasis">serv</span> and <span class="docEmphasis">servlen</span> specify the service string. If the caller does not want the host string returned, a <span class="docEmphasis">hostlen</span> of 0 is specified. Similarly, a <span class="docEmphasis">servlen</span> of 0 specifies not to return information on the service.</P>
<P class="docText">The difference between <TT>sock_ntop</TT> and <TT>getnameinfo</TT> is that the former does not involve the DNS and just returns a printable version of the IP address and port number. The latter normally tries to obtain a name for both the host and service.</P>
<P class="docText"><A class="docLink" HREF="#ch11fig20">Figure 11.20</A> shows the six <span class="docEmphasis">flags</span> that can be specified to change the operation of <TT>getnameinfo</TT>.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch11fig20"></A>Figure 11.20. <span class="docEmphasis">flags</span> for <TT>getnameinfo</TT>.</H5>

<p class="docText">
<IMG BORDER="0" WIDTH="412" HEIGHT="110" src="FILES/11fig20.gif" ALT="graphics/11fig20.gif"></p>

</CENTER>
<P class="docText"><TT>NI_DGRAM</TT> should be specified when the caller knows it is dealing with a datagram socket. The reason is that given only the IP address and port number in the socket address structure, <TT>getnameinfo</TT> cannot determine the protocol (TCP or UDP). There are a few port numbers that are used for one service with TCP and a completely different service with UDP. An example is port 514, which is the <TT>rsh</TT> service with TCP, but the <TT>syslog</TT> service with UDP.</P>
<P class="docText"><TT>NI_NAMEREQD</TT> causes an error to be returned if the hostname cannot be resolved using the DNS. This can be used by servers that require the client's IP address to be mapped into a hostname. These servers then take this returned hostname and call <TT>getaddrinfo</TT>, and then verify that one of the returned addresses is the address in the socket address structure.</P>
<P class="docText"><TT>NI_NOFQDN</TT> causes the returned hostname to be truncated at the first period. For example, if the IP address in the socket address structure was 192.168.42.2, <TT>gethostbyaddr</TT> would return a name of <TT>aix.unpbook.com</TT>. But if this flag was specified to <TT>getnameinfo</TT>, it would return the hostname as just <TT>aix</TT>.</P>
<P class="docText"><TT>NI_NUMERICHOST</TT> tells <TT>getnameinfo</TT> not to call the DNS (which can take time). Instead, the numeric representation of the IP address is returned as a string, probably by calling <TT>inet_ntop</TT>. Similarly, <TT>NI_NUMERICSERV</TT> specifies that the decimal port number is to be returned as a string instead of looking up the service name, and <TT>NI_NUMERICSCOPE</TT> specifies that the numeric form of the scope identifier is to be returned instead of its name. Servers should normally specify <TT>NI_NUMERICSERV</TT> because the client port numbers typically have no associated service name—they are ephemeral ports.</P>
<P class="docText">The logical OR of multiple flags can be specified if they make sense together (e.g., <TT>NI_DGRAM</TT> and <TT>NI_NUMERICHOST</TT>).</P>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch11lev1sec16.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch11lev1sec18.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
