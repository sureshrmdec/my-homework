<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="14.3 'recv' and 'send' Functions"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch14lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch14lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch14lev1sec3"></A>
<H3 class="docSection1Title" id="225793-956">14.3 <TT>recv</TT> and <TT>send</TT> Functions</H3>
<P class="docText">These two functions are similar to the standard <TT>read</TT> and <TT>write</TT> functions, but one additional argument is required.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;sys/socket.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>ssize_t recv(int</TT> <span class="docEmphasis">sockfd</span>, <TT>void *</TT><span class="docEmphasis">buff</span>, <TT>size_t</TT> <span class="docEmphasis">nbytes</span>, <TT>int</TT> <span class="docEmphasis">flags</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>ssize_t send(int</TT> <span class="docEmphasis">sockfd</span>, <TT>const void *</TT><span class="docEmphasis">buff</span>, <TT>size_t</TT> <span class="docEmphasis">nbytes</span>, <TT>int</TT> <span class="docEmphasis">flags</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">Both return: number of bytes read or written if OK, –1 on error</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">The first three arguments to <TT>recv</TT> and <TT>send</TT> are the same as the first three arguments to <TT>read</TT> and <TT>write</TT>. The <span class="docEmphasis">flags</span> argument is either 0 or is formed by logically OR'ing one or more of the constants shown in <A class="docLink" HREF="#ch14fig06">Figure 14.6</A>.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch14fig06"></A>Figure 14.6. <span class="docEmphasis">flags</span> for I/O functions.</H5>

<p class="docText">
<IMG BORDER="0" id="129022115118" WIDTH="380" HEIGHT="99" src="FILES/14fig06.gif" ALT="graphics/14fig06.gif"></p>

</CENTER>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="2"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>MSG_DONTROUTE</TT></P></TD><TD class="docTableCell" valign="top"><P class="docText">This flag tells the kernel that the destination is on a locally attached network and not to perform a lookup of the routing table. We provided additional information on this feature with the <TT>SO_DONTROUTE</TT> socket option (<A class="docLink" HREF="0131411551_ch07lev1sec5.html#ch07lev1sec5">Section 7.5</A>). This feature can be enabled for a single output operation with the <TT>MSG_DONTROUTE</TT> flag, or enabled for all output operations for a given socket using the socket option.</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>MSG_DONTWAIT</TT></P></TD><TD class="docTableCell" valign="top"><P class="docText">This flag specifies nonblocking for a single I/O operation, without having to turn on the nonblocking flag for the socket, perform the I/O operation, and then turn off the nonblocking flag. We will describe nonblocking I/O in <A class="docLink" HREF="0131411551_ch16.html#ch16">Chapter 16</A>, along with turning the nonblocking flag on and off for all I/O operations on a socket.</P></TD></TR><TR><TD class="docTableCell" valign="top">&nbsp;</TD><TD class="docTableCell" valign="top"><P class="docText">This flag is newer than the others and might not be supported on all systems.</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>MSG_OOB</TT></P></TD><TD class="docTableCell" valign="top"><P class="docText">With <TT>send</TT>, this flag specifies that out-of-band data is being sent. With TCP, only one byte should be sent as out-of-band data, as we will describe in <A class="docLink" HREF="0131411551_ch24.html#ch24">Chapter 24</A>. With <TT>recv</TT>, this flag specifies that out-of-band data is to be read instead of normal data.</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>MSG_PEEK</TT></P></TD><TD class="docTableCell" valign="top"><P class="docText">This flag lets us look at the data that is available to be read, without having the system discard the data after the <TT>recv</TT> or <TT>recvfrom</TT> returns. We will talk more about this in <A class="docLink" HREF="0131411551_ch14lev1sec7.html#ch14lev1sec7">Section 14.7</A>.</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>MSG_WAITALL</TT></P></TD><TD class="docTableCell" valign="top"><P class="docText">This flag was introduced with 4.3BSD Reno. It tells the kernel not to return from a <TT>read</TT> operation until the requested number of bytes have been read. If the system supports this flag, we can then omit the <TT>readn</TT> function (<A class="docLink" HREF="0131411551_ch03lev1sec9.html#ch03fig15">Figure 3.15</A>) and replace it with the following macro:</P>

<A NAME="PLID0"></A><div class="v1"><a href="&r=noccc&xmlid=0-13-141155-1/ch14lev1sec3#PLID0">[View full width]</a></div><PRE>
#define readn(fd, ptr, n)   recv(fd, ptr, n,
<IMG BORDER="0" width="14" height="9" ALIGN="left" src="FILES/ccc.gif" ALT="graphics/ccc.gif"> MSG_WAITALL)
</PRE>
<P class="docText">Even if we specify <TT>MSG_WAITALL</TT>, the function can still return fewer than the requested number of bytes if (i) a signal is caught, (ii) the connection is terminated, or (iii) an error is pending for the socket.</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">There are additional flags used by other protocols, but not TCP/IP. For example, the OSI transport layer is record-based (not a byte stream such as TCP) and supports the <TT>MSG_EOR</TT> flag for output operations to specify the end of a logical record.</P>
<P class="docText">There is a fundamental design problem with the <span class="docEmphasis">flags</span> argument: It is passed by value; it is not a value-result argument. Therefore, it can be used only to pass flags from the process to the kernel. The kernel cannot pass back flags to the process. This is not a problem with TCP/IP, because it is rare to need to pass flags back to the process from the kernel. But when the OSI protocols were added to 4.3BSD Reno, the need arose to return <TT>MSG_EOR</TT> to the process with an input operation. Thus, the decision was made with 4.3BSD Reno to leave the arguments to the commonly used input functions (<TT>recv</TT> and <TT>recvfrom</TT>) as-is and change the <TT>msghdr</TT> structure that is used with <TT>recvmsg</TT> and <TT>sendmsg</TT>. We will see in <A class="docLink" HREF="0131411551_ch14lev1sec5.html#ch14lev1sec5">Section 14.5</A> that an integer <TT>msg_flags</TT> member was added to this structure, and since the structure is passed by reference, the kernel can modify these flags on return. This also means that if a process needs to have the flags updated by the kernel, the process must call <TT>recvmsg</TT> instead of either <TT>recv</TT> or <TT>recvfrom</TT>.</P>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch14lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch14lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
