<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="Chapter 21"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_app05lev1sec19.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_app05lev1sec21.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="app05lev1sec20"></A>
<H3 class="docSection1Title"> Chapter 21</H3>
<P><TABLE BORDER="0" cellspacing="16" cellpadding="0"><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch21a01"></A><B><A class="docLink" HREF="0131411551_ch21lev1sec13.html#ch21q01">21.1</A></B></TD><TD><P class="docText">When we run the program, there is no output. To prevent accidental reception of multicast datagrams that a server is not expecting, the kernel does not deliver multicast groups to a socket that has never performed any multicast operations (e.g., joining a group). What is happening here is that the destination address of the UDP datagram is 224.0.0.1, the all-hosts group that all multicast-capable nodes must join. The UDP datagram is sent as a multicast Ethernet frame and all the multicast-capable nodes receive the datagram since they all belong to the group. However, the kernel drops the received datagram since the process bound to the daytime port has not set any multicast options.</P></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch21a02"></A><B><A class="docLink" HREF="0131411551_ch21lev1sec13.html#ch21q02">21.2</A></B></TD><TD><P class="docText"><A class="docLink" HREF="#app05fig14">Figure E.14</A> shows a simple modification to the <TT>main</TT> function to <TT>bind</TT> the multicast address and port 0.</P>
<H5 class="docExampleTitle"><A NAME="app05fig14"></A>Figure E.14 UDP client <TT>main</TT> function that <TT>binds</TT> a multicast address.</H5>
<P class="docText"><span class="docEmphasis">mcast/udpcli06.c</span></P>
<PRE>
 1 #include    "unp.h"

 2 int
 3 main(int argc, char **argv)
 4 {
 5     int     sockfd;
 6     socklen_t salen;
 7     struct sockaddr *cli,  *serv;

 8     if (argc != 2)
 9         err_quit("usage: udpcli06 &lt;IPaddress&gt;");

10     sockfd = Udp_client(argv[1], "daytime", (void **) &amp;serv, &amp;salen);

11     cli = Malloc(salen);
12     memcpy(cli, serv, salen);   /* copy socket address struct */
13     sock_set_port(cli, salen, 0);   /* and set port to 0 */
14     Bind(sockfd, cli, salen);

15     dg_cli(stdin, sockfd, serv, salen);

16     exit(0);
17 }
</PRE>
<P class="docText">Unfortunately, on the three systems on which this was tried—FreeBSD 4.8, MacOS X, and Linux 2.4.7—all allowed the <TT>bind</TT> and then sent the UDP datagrams with a multicast source IP address.</P></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch21a03"></A><B><A class="docLink" HREF="0131411551_ch21lev1sec13.html#ch21q03">21.3</A></B></TD><TD><P class="docText"><span class="docEmphStrong">21.3</span> If we do this from our host <TT>aix</TT>, which is multicast-capable, we get the following:</P><pre>
</pre><pre>
aix % <span class="docEmphStrong">ping 224.0.0.1</span>
PING 224.0.0.1: 56 data bytes
64 bytes from 192.168.42.2: icmp_seq=0 ttl=255 time=0 ms
64 bytes from 192.168.42.1: icmp_seq=0 ttl=64 time=1 ms (DUP!)
<span class="docEmphStrong">^C</span>
----224.0.0.1 PING Statistics----
1 packets transmitted, 1 packets received, +1 duplicates, 0% packet loss
round-trip min/avg/max = 0/0/0 ms
</pre><pre>
</pre><P class="docText">Both systems on the right-hand Ethernet in <A class="docLink" HREF="0131411551_ch01lev1sec9.html#ch01fig16">Figure 1.16</A> respond.</P><BLOCKQUOTE><P><P class="docList">To prevent certain denial-of-service attacks, some systems do not respond to broadcast or multicast pings by default. To get <TT>freebsd</TT> to respond, we had to configure it with</P><pre>
</pre><pre>
freebsd % <span class="docEmphStrong">sysctl net.inet.icmp.bmcastecho=1</span>
</pre><pre>
</pre></P></BLOCKQUOTE></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch21a05"></A><B><A class="docLink" HREF="0131411551_ch21lev1sec13.html#ch21q05">21.5</A></B></TD><TD><P class="docText">The value 1,073,741,824 is converted to a floating-point number and divided by 4,294,967,296, yielding 0.250. This is multiplied by 1,000,000, yielding 250,000, which in microseconds is one-quarter of a second.</P><P class="docText">The largest fraction is 4,294,967,295, which divided by 4,294,967,296 yields 0.99999999976716935634. Multiplying this by 1,000,000 and truncating to an integer yields 999,999, the largest value for the number of microseconds.</P></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR></TABLE></P><br>
<P class="docText"></P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_app05lev1sec19.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_app05lev1sec21.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
