<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="17.5 Interface Configuration"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch17lev1sec4.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch17lev1sec6.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch17lev1sec5"></A>
<H3 class="docSection1Title" id="225793-944">17.5 Interface Configuration</H3>
<P class="docText">One of the first steps employed by many programs that deal with the network interfaces on a system is to obtain from the kernel all the interfaces configured on the system. This is done with the <TT>SIOCGIFCONF</TT> request, which uses the <TT>ifconf</TT> structure, which in turn uses the <TT>ifreq</TT> structure, both of which are shown in <A class="docLink" HREF="#ch17fig02">Figure 17.2</A>.</P>

<H5 class="docExampleTitle"><A NAME="ch17fig02"></A>Figure 17.2 <TT>ifconf</TT> and <TT>ifreq</TT> structures used with various interface <TT>ioctl</TT> requests.</H5>
<P class="docText">&lt;<span class="docEmphasis">net/if.h</span>&gt;</P>

<PRE>
struct ifconf {
    int  ifc_len;                 /* size of buffer, value-result */
    union {
        caddr_t ifcu_buf;         /* input from user -&gt; kernel */
        struct ifreq *ifcu_req;   /* return from kernel -&gt; user */
    } ifc_ifcu;
};
#define ifc_buf ifc_ifcu.ifcu_buf /* buffer address */
#define ifc_req ifc_ifcu.ifcu_req /* array of structures returned */

#define IFNAMSIZ     16

struct ifreq {
    char    ifr_name[IFNAMSIZ];  /* interface name, e.g., "le0" */
    union {
        struct  sockaddr ifru_addr;
        struct  sockaddr ifru_dstaddr;
        struct  sockaddr ifru_broadaddr;
        short   ifru_flags;
        int     ifru_metric;
        caddr_t ifru_data;
    } ifr_ifru;
};
#define ifr_addr         ifr_ifru.ifru_addr         /* address */
#define ifr_dstaddr      ifr_ifru.ifru_dstaddr      /* other end of point-to-point link */
#define ifr_broadaddr    ifr_ifru.ifru_broadaddr    /* broadcast address */
#define ifr_flags        ifr_ifru.ifru_flags        /* flags */
#define ifr_metric       ifr_ifru.ifru_metric       /* metric */
#define ifr_data         ifr_ifru.ifru_data         /* for use by interface */
</PRE>

<P class="docText">Before calling <TT>ioctl</TT>, we allocate a buffer and an <TT>ifconf</TT> structure and then initialize the latter. We show a picture of this in <A class="docLink" HREF="#ch17fig03">Figure 17.3</A> (p. 470), assuming our buffer size is 1,024 bytes. The third argument to <TT>ioctl</TT> is a pointer to our <TT>ifconf</TT> structure.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch17fig03"></A>Figure 17.3. Initialization of <TT>ifconf</TT> structure before <TT>SIOCGIFCONF</TT>.</H5>

<p class="docText">
<IMG BORDER="0" id="129022115118" WIDTH="354" HEIGHT="414" src="FILES/17fig03.gif" ALT="graphics/17fig03.gif"></p>

</CENTER>
<P class="docText">If we assume that the kernel returns two <TT>ifreq</TT> structures, we could have the arrangement shown in <A class="docLink" HREF="#ch17fig04">Figure 17.4</A> (p. 470) when the <TT>ioctl</TT> returns. The shaded regions have been modified by <TT>ioctl</TT>. The buffer has been filled in with the two structures and the <TT>ifc_len</TT> member of the <TT>ifconf</TT> structure has been updated to reflect the amount of information stored in the buffer. We assume in this figure that each <TT>ifreq</TT> structure occupies 32 bytes.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch17fig04"></A>Figure 17.4. Values returned by <TT>SIOCGIFCONF</TT>.</H5>

<p class="docText">
<IMG BORDER="0" id="129022115118" WIDTH="438" HEIGHT="416" src="FILES/17fig04.gif" ALT="graphics/17fig04.gif"></p>

</CENTER>
<P class="docText">A pointer to an <TT>ifreq</TT> structure is also used as an argument to the remaining interface <TT>ioctls</TT> shown in <A class="docLink" HREF="0131411551_ch17lev1sec2.html#ch17fig01">Figure 17.1</A>, which we will describe in <A class="docLink" HREF="0131411551_ch17lev1sec7.html#ch17lev1sec7">Section 17.7</A>. Notice that each <TT>ifreq</TT> structure contains a <TT>union</TT> and there are numerous <TT>#defines</TT> to hide the fact that these fields are members of a <TT>union</TT>. All references to individual members are made using defined names. Be aware that some systems have added many implementation-dependent members to the <TT>ifr_ifru union</TT>.</P>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch17lev1sec4.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch17lev1sec6.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
