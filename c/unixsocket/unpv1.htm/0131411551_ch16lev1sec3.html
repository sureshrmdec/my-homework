<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="16.3 Nonblocking 'connect'"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch16lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch16lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch16lev1sec3"></A>
<H3 class="docSection1Title">16.3 Nonblocking <TT>connect</TT></H3>
<P class="docText">When a TCP socket is set to nonblocking and then <TT>connect</TT> is called, <TT>connect</TT> returns immediately with an error of <TT>EINPROGRESS</TT> but the TCP three-way handshake continues. We then check for either a successful or unsuccessful completion of the connection's establishment using <TT>select</TT>. There are three uses for a nonblocking <TT>connect:</TT></P>
<span style="font-weight:bold"><OL class="docList" TYPE="1"><LI><span style="font-weight:normal"><P class="docList">We can overlap other processing with the three-way handshake. A <TT>connect</TT> takes one RTT to complete (<A class="docLink" HREF="0131411551_ch02lev1sec6.html#ch02lev1sec6">Section 2.6</A>) and this can be anywhere from a few milliseconds on a LAN to hundreds of milliseconds or a few seconds on a WAN. There might be other processing we wish to perform during this time.</P></span></LI><LI><span style="font-weight:normal"><P class="docList">We can establish multiple connections at the same time using this technique. This has become popular with Web browsers, and we will show an example of this in <A class="docLink" HREF="0131411551_ch16lev1sec5.html#ch16lev1sec5">Section 16.5</A>.</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Since we wait for the connection to be established using <TT>select</TT>, we can specify a time limit for <TT>select</TT>, allowing us to shorten the timeout for the <TT>connect</TT>. Many implementations have a timeout for <TT>connect</TT> that is between 75 seconds and several minutes. There are times when an application wants a shorter timeout, and using a nonblocking <TT>connect</TT> is one way to accomplish this. <A class="docLink" HREF="0131411551_ch14lev1sec2.html#ch14lev1sec2">Section 14.2</A> talks about other ways to place timeouts on socket operations.</P></span></LI></OL></span>
<P class="docText">As simple as the nonblocking <TT>connect</TT> sounds, there are other details we must handle:</P>
<UL><LI><P class="docList">Even though the socket is nonblocking, if the server to which we are connecting is on the same host, the connection is normally established immediately when we call <TT>connect</TT>. We must handle this scenario.</P></LI><LI><P class="docList">Berkeley-derived implementations (and POSIX) have the following two rules regarding <TT>select</TT> and nonblocking <TT>connects:</TT></P></LI></UL>
<span style="font-weight:bold"><OL class="docList" TYPE="1"><LI><span style="font-weight:normal"><P class="docList">When the connection completes successfully, the descriptor becomes writable (p. 531 of TCPv2).</P></span></LI><LI><span style="font-weight:normal"><P class="docList">When the connection establishment encounters an error, the descriptor becomes both readable and writable (p. 530 of TCPv2).</P><BLOCKQUOTE><P><P class="docList">These two rules regarding <TT>select</TT> fall out from our rules in <A class="docLink" HREF="0131411551_ch06lev1sec3.html#ch06lev1sec3">Section 6.3</A> about the conditions that make a descriptor ready. A TCP socket is writable if there is available space in the send buffer (which will always be the case for a connecting socket since we have not yet written anything to the socket) <span class="docEmphasis">and</span> the socket is connected (which occurs only when the three-way handshake completes). A pending error causes a socket to be both readable and writable.</P></P></BLOCKQUOTE></span></LI></OL></span>
<P class="docText">There are many portability problems with nonblocking <TT>connects</TT> that we mention in the examples that follow.</P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch16lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch16lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
