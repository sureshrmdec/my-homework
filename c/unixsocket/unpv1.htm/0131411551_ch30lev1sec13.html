<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="30.13 Summary"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch30lev1sec12.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch30lev1sec14.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch30lev1sec13"></A>
<H3 class="docSection1Title">30.13 Summary</H3>
<P class="docText">In this chapter, we looked at nine different server designs and ran them all against the same Web-style client, comparing the amount of CPU time spent performing process control:</P>
<BLOCKQUOTE><P><P class="docList">0. Iterative server (baseline measurement; no process control)</P></P><P><P class="docList">1. Concurrent server, one <TT>fork</TT> per client</P></P><P><P class="docList">2. Preforked, with each child calling <TT>accept</TT></P></P><P><P class="docList">3. Preforked, with file locking to protect <TT>accept</TT></P></P><P><P class="docList">4. Preforked, with thread mutex locking to protect <TT>accept</TT></P></P><P><P class="docList">5. Preforked, with parent passing socket descriptor to child</P></P><P><P class="docList">6. Concurrent server, create one thread per client request</P></P><P><P class="docList">7. Prethreaded with mutex locking to protect <TT>accept</TT></P></P><P><P class="docList">8. Prethreaded with main thread calling <TT>accept</TT></P></P></BLOCKQUOTE>
<P class="docText">We can make a few summary comments:</P>
<UL><LI><P class="docList">First, if the server is not heavily used, the traditional concurrent server model, with one <TT>fork</TT> per client, is fine. This can even be combined with <TT>inetd</TT>, letting it handle the accepting of each connection. The remainder of our comments are meant for heavily used servers, such as Web servers.</P></LI><LI><P class="docList">Creating a pool of children or a pool of threads reduces the process control CPU time compared to the traditional one-<TT>fork</TT>-per-client design by a factor of 10 or more. The coding is not complicated, but what is required, above and beyond the examples that we have shown, is monitoring the number of free children and increasing or decreasing this number as the number of clients being served changes dynamically.</P></LI><LI><P class="docList">Some implementations allow multiple children or threads to block in a call to <TT>accept</TT>, while on other implementations, we must place some type of lock around the call to <TT>accept</TT>. Either file locking or Pthread mutex locking can be used.</P></LI><LI><P class="docList">Having all the children or threads call <TT>accept</TT> is normally simpler and faster than having the main thread call <TT>accept</TT> and then pass the descriptor to the child or thread.</P></LI><LI><P class="docList">Having all the children or threads block in a call to <TT>accept</TT> is preferable over blocking in a call to <TT>select</TT> because of the potential for <TT>select</TT> collisions.</P></LI><LI><P class="docList">Using threads is normally faster than using processes. But, the choice of one-child-per-client or one-thread-per-client depends on what the OS provides and can also depend on what other programs, if any, are invoked to service each client. For example, if the server that <TT>accepts</TT> the client's connection calls <TT>fork</TT> and <TT>exec</TT>, it can be faster to <TT>fork</TT> a single threaded process than to <TT>fork</TT> a multithreaded process.</P></LI></UL>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch30lev1sec12.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch30lev1sec14.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
