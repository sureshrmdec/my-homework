<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="Chapter 24"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_app05lev1sec21.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_app05lev1sec23.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="app05lev1sec22"></A>
<H3 class="docSection1Title"> Chapter 24</H3>
<P><TABLE BORDER="0" cellspacing="16" cellpadding="0"><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch24a01"></A><B><A class="docLink" HREF="0131411551_ch24lev1sec6.html#ch24q01">24.1</A></B></TD><TD><P class="docText">Yes, in the first example, 2 bytes are sent with a single urgent pointer that points to the byte following the <TT>b</TT>. But in the second example (the two function calls), first the <TT>a</TT> is sent with an urgent pointer that points just beyond it, and this is followed by another TCP segment containing the <TT>b</TT> with a different urgent pointer that points just beyond it.</P></TD></TR><TR valign="top"><TD align="right" class="docText"><B></B></TD><TD><P class="docText"></P></TD></TR><TR valign="top"><TD align="right" class="docText"><A NAME="ch24a02"></A><B><A class="docLink" HREF="0131411551_ch24lev1sec6.html#ch24q02">24.2</A></B></TD><TD><P class="docText"><span class="docEmphStrong">24.2</span> <A class="docLink" HREF="#app05fig16">Figure E.16</A> shows the version using <TT>poll</TT>.</P>
<H5 class="docExampleTitle"><A NAME="app05fig16"></A>Figure E.16 Version of <A class="docLink" HREF="0131411551_ch24lev1sec2.html#ch24fig06">Figure 24.6</A> using <TT>poll</TT> instead of <TT>select</TT>.</H5>
<P class="docText"><span class="docEmphasis">oob/tcprecv03p.c</span></P>
<PRE>
 1 #include   "unp.h"

 2 int
 3 main(int argc, char **argv)
 4 {
 5     int     listenfd, connfd, n, justreadoob = 0;
 6     char    buff[100];
 7     struct pollfd pollfd[1];

 8     if (argc == 2)
 9         listenfd = Tcp_listen(NULL, argv[1], NULL);
10     else if (argc == 3)
11         listenfd = Tcp_listen(argv[1], argv[2], NULL);
12     else
13         err_quit("usage: tcprecv03p [ &lt;host&gt; ] &lt;port#&gt;");

14     connfd = Accept(listenfd, NULL, NULL);

15     pollfd[0].fd = connfd;
16     pollfd[0].events = POLLRDNORM;
17     for ( ; ; ) {
18         if (justreadoob == 0)
19             pollfd[0].events|= POLLRDBAND;
20         Poll(pollfd, 1, INFTIM);

21         if (pollfd[0].revents &amp; POLLRDBAND) {
22             n = Recv(connfd, buff, sizeof(buff) - 1, MSG_OOB);
23             buff[n] = 0;        /* null terminate */
24             printf("read %d OOB byte: %s\n", n, buff);
25             justreadoob = 1;
26             pollfd[0].events &amp;= ~POLLRDBAND;    /* turn bit off */
27         }

28         if (pollfd[0].revents &amp; POLLRDNORM) {
29             if ( (n = Read(connfd, buff, sizeof(buff) - 1)) == 0) {
30                 printf("received EOF\n");
31                 exit(0);
32             }
33             buff[n] = 0;        /* null terminate */
34             printf("read %d bytes: %s\n", n, buff);
35             justreadoob = 0;
36         }
37     }
38 }
</PRE>
</TD></TR></TABLE></P><br>
<P class="docText"></P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_app05lev1sec21.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_app05lev1sec23.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
