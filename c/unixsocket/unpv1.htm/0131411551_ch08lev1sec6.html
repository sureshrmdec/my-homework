<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="8.6 UDP Echo Client: 'dg_cli' Function"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch08lev1sec5.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch08lev1sec7.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch08lev1sec6"></A>
<H3 class="docSection1Title" id="225793-882">8.6 UDP Echo Client: <TT>dg_cli</TT> Function</H3>
<P class="docText"><A class="docLink" HREF="#ch08fig08">Figure 8.8</A> shows the function <TT>dg_cli</TT>, which performs most of the client processing.</P>

<H5 class="docExampleTitle"><A NAME="ch08fig08"></A>Figure 8.8 <TT>dg_cli</TT> function: client processing loop.</H5>
<P class="docText"><span class="docEmphasis">lib/dg_cli.c</span></P>

<PRE>
 1 #include     "unp.h"

 2 void
 3 dg_cli(FILE *fp, int sockfd, const SA *pservaddr, socklen_t servlen)
 4 {
 5     int     n;
 6     char    sendline[MAXLINE], recvline[MAXLINE + 1];

 7     while (Fgets(sendline, MAXLINE, fp) != NULL) {

 8         Sendto(sockfd, sendline, strlen(sendline), 0, pservaddr, servlen);

 9         n = Recvfrom(sockfd, recvline, MAXLINE, 0, NULL, NULL);

10         recvline[n] = 0;        /* null terminate */
11         Fputs(recvline, stdout);
12     }
13 }
</PRE>

<p class="docText"><span class="docEmphasis"><TT>7–12</TT></span> There are four steps in the client processing loop: read a line from standard input using <TT>fgets</TT>, send the line to the server using <TT>sendto</TT>, read back the server's echo using <TT>recvfrom</TT>, and print the echoed line to standard output using <TT>fputs</TT>.</p>
<P class="docText">Our client has not asked the kernel to assign an ephemeral port to its socket. (With a TCP client, we said the call to <TT>connect</TT> is where this takes place.) With a UDP socket, the first time the process calls <TT>sendto</TT>, if the socket has not yet had a local port bound to it, that is when an ephemeral port is chosen by the kernel for the socket. As with TCP, the client can call <TT>bind</TT> explicitly, but this is rarely done.</P>
<P class="docText">Notice that the call to <TT>recvfrom</TT> specifies a null pointer as the fifth and sixth arguments. This tells the kernel that we are not interested in knowing who sent the reply. There is a risk that any process, on either the same host or some other host, can send a datagram to the client's IP address and port, and that datagram will be read by the client, who will think it is the server's reply. We will address this in <A class="docLink" HREF="0131411551_ch08lev1sec8.html#ch08lev1sec8">Section 8.8</A>.</P>
<P class="docText">As with the server function <TT>dg_echo</TT>, the client function <TT>dg_cli</TT> is protocol-independent, but the client <TT>main</TT> function is protocol-dependent. The <TT>main</TT> function allocates and initializes a socket address structure of some protocol type and then passes a pointer to this structure, along with its size, to <TT>dg_cli</TT>.</P>

<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch08lev1sec5.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch08lev1sec7.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
