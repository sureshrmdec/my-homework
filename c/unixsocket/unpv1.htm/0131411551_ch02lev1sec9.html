<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="2.9 Port Numbers"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch02lev1sec8.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch02lev1sec10.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch02lev1sec9"></A>
<H3 class="docSection1Title" id="225793-993">2.9 Port Numbers</H3>
<P class="docText">At any given time, multiple processes can be using any given transport: UDP, SCTP, or TCP. All three transport layers use 16-bit integer <span class="docEmphasis">port numbers</span> to differentiate between these processes.</P>
<P class="docText">When a client wants to contact a server, the client must identify the server with which it wants to communicate. TCP, UDP, and SCTP define a group of <span class="docEmphasis">well-known ports</span> to identify well-known services. For example, every TCP/IP implementation that supports FTP assigns the well-known port of 21 (decimal) to the FTP server. Trivial File Transfer Protocol (TFTP) servers are assigned the UDP port of 69.</P>
<P class="docText">Clients, on the other hand, normally use <span class="docEmphasis">ephemeral ports</span>, that is, short-lived ports. These port numbers are normally assigned automatically by the transport protocol to the client. Clients normally do not care about the value of the ephemeral port; the client just needs to be certain that the ephemeral port is unique on the client host. The transport protocol code guarantees this uniqueness.</P>
<P class="docText">The <span class="docEmphasis">Internet Assigned Numbers Authority</span> (IANA) maintains a list of port number assignments. Assignments were once published as RFCs; RFC 1700 [Reynolds and Postel 1994] is the last in this series. RFC 3232 [Reynolds 2002] gives the location of the online database that replaced RFC 1700: <A class="docLink" target="_blank" HREF="http://www.iana.org/default.htm">http://www.iana.org/</A>. The port numbers are divided into three ranges:</P>
<span style="font-weight:bold"><OL class="docList" TYPE="1"><LI><span style="font-weight:normal"><p class="docText"><span class="docEmphRoman">The</span> <span class="docEmphasis">well-known ports:</span> <span class="docEmphRoman">0 through 1023.</span> These port numbers are controlled and assigned by the IANA. When possible, the same port is assigned to a given service for TCP, UDP, and SCTP. For example, port 80 is assigned for a Web server, for both TCP and UDP, even though all implementations currently use only TCP.</p><BLOCKQUOTE><P><P class="docList">At the time that port 80 was assigned, SCTP did not yet exist. New port assignments are made for all three protocols, and RFC 2960 states that all existing TCP port numbers should be valid for the same service using SCTP.</P></P></BLOCKQUOTE></span></LI><LI><span style="font-weight:normal"><p class="docText"><span class="docEmphRoman">The</span> <span class="docEmphasis">registered ports:</span> <span class="docEmphRoman">1024 through 49151.</span> These are not controlled by the IANA, but the IANA registers and lists the uses of these ports as a convenience to the community. When possible, the same port is assigned to a given service for both TCP and UDP. For example, ports 6000 through 6063 are assigned for an X Window server for both protocols, even though all implementations currently use only TCP. The upper limit of 49151 for these ports was introduced to allow a range for ephemeral ports; RFC 1700 [Reynolds and Postel 1994] lists the upper range as 65535.</p></span></LI><LI><span style="font-weight:normal"><p class="docText"><span class="docEmphRoman">The</span> <span class="docEmphasis">dynamic</span> <span class="docEmphRoman">or</span> <span class="docEmphasis">private</span> <span class="docEmphRoman">ports, 49152 through 65535.</span> The IANA says nothing about these ports. These are what we call <span class="docEmphasis">ephemeral</span> ports. (The magic number 49152 is three-fourths of 65536.)</p></span></LI></OL></span>
<P class="docText"><A class="docLink" HREF="#ch02fig10">Figure 2.10</A> shows this division, along with the common allocation of the port numbers.</P>
<CENTER>
<H5 class="docFigureTitle"><A NAME="ch02fig10"></A>Figure 2.10. Allocation of port numbers.</H5>

<p class="docText">
<IMG BORDER="0" id="129022115118" WIDTH="500" HEIGHT="178" src="FILES/02fig10.gif" ALT="graphics/02fig10.gif"></p>

</CENTER>
<P class="docText">We note the following points from this figure:</P>
<UL><LI><P class="docList">Unix systems have the concept of a <span class="docEmphasis">reserved port</span>, which is any port less than 1024. These ports can only be assigned to a socket by an appropriately privileged process. All the IANA well-known ports are reserved ports; hence, the server allocating this port (such as the FTP server) must have superuser privileges when it starts.</P></LI><LI><P class="docList">Historically, Berkeley-derived implementations (starting with 4.3BSD) have allocated ephemeral ports in the range 1024–5000. This was fine in the early 1980s, but it is easy today to find a host that can support more than 3977 connections at any given time. Therefore, many newer systems allocate ephemeral ports differently to provide more ephemeral ports, either using the IANA-defined ephemeral range or a larger range (e.g., Solaris as we show in <A class="docLink" HREF="#ch02fig10">Figure 2.10</A>).</P><BLOCKQUOTE><P><P class="docList">As it turns out, the upper limit of 5000 for the ephemeral ports, which many older systems implement, was a typo [Borman 1997a]. The limit should have been 50,000.</P></P></BLOCKQUOTE></LI><LI><P class="docList">There are a few clients (not servers) that require a reserved port as part of the client/server authentication: the <TT>rlogin</TT> and <TT>rsh</TT> clients are common examples. These clients call the library function <TT>rresvport</TT> to create a TCP socket and assign an unused port in the range 513–1023 to the socket. This function normally tries to bind port 1023, and if that fails, it tries to bind 1022, and so on, until it either succeeds or fails on port 513.</P><BLOCKQUOTE><P><P class="docList">Notice that the BSD reserved ports and the <TT>rresvport</TT> function both overlap with the upper half of the IANA well-known ports. This is because the IANA well-known ports used to stop at 255. RFC 1340 (a previous "Assigned Numbers" RFC) in 1992 started assigning well-known ports between 256 and 1023. The previous "Assigned Numbers" document, RFC 1060 in 1990, called ports 256–1023 the <span class="docEmphasis">Unix Standard Services</span>. There are numerous Berkeley-derived servers that picked their well-known ports in the 1980s starting at 512 (leaving 256–511 untouched). The <TT>rresvport</TT> function chose to start at the top of the 512–1023 range and work down.</P></P></BLOCKQUOTE></LI></UL>
<A NAME="ch02lev2sec11"></A>
<H4 class="docSection2Title"> Socket Pair</H4>
<P class="docText">The <span class="docEmphasis">socket pair</span> for a TCP connection is the four-tuple that defines the two endpoints of the connection: the local IP address, local port, foreign IP address, and foreign port. A socket pair uniquely identifies every TCP connection on a network. For SCTP, an association is identified by a set of local IP addresses, a local port, a set of foreign IP addresses, and a foreign port. In its simplest form, where neither endpoint is multihomed, this results in the same four-tuple socket pair used with TCP. However, when either of the endpoints of an association are multihomed, then multiple four-tuple sets (with different IP addresses but the same port numbers) may identify the same association.</P>
<P class="docText">The two values that identify each endpoint, an IP address and a port number, are often called a <span class="docEmphasis">socket</span>.</P>
<P class="docText">We can extend the concept of a socket pair to UDP, even though UDP is connectionless. When we describe the socket functions (<TT>bind</TT>, <TT>connect</TT>, <TT>getpeername</TT>, etc.), we will note which functions specify which values in the socket pair. For example, <TT>bind</TT> lets the application specify the local IP address and local port for TCP, UDP, and SCTP sockets.</P>


<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch02lev1sec8.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch02lev1sec10.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
