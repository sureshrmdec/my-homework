<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="23.2 An Autoclosing One-to-Many-Style Server"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch23lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch23lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch23lev1sec2"></A>
<H3 class="docSection1Title" id="162666-922">23.2 An Autoclosing One-to-Many-Style Server</H3>
<P class="docText">Recall the server program we wrote in <A class="docLink" HREF="0131411551_ch10.html#ch10">Chapter 10</A>. That program does not keep track of any associations. The server depends on the client to close the association, thereby removing the association state. But depending on the client to close the association leaves a weakness: What happens if a client opens an association and never sends any data? Resources would be allocated to a client that never uses them. This dependency could introduce an accidental denial-of-service attack to our SCTP implementation from lazy clients. To avoid this problem, an <span class="docEmphasis">autoclose</span> feature was added to SCTP.</P>
<P class="docText">Autoclose lets an SCTP endpoint specify a maximum number of seconds an association may remain idle. An association is considered idle when it is not transmitting user data in either direction. If an association is idle for more than this maximum time, the association is automatically closed by the SCTP implementation.</P>
<P class="docText">When using this option, care should be taken in choosing a value for autoclose. The server should not pick too small a value, otherwise it may find itself needing to send data on an association that has been closed. There would be extra overhead in re-opening the association to send back the data to the client, and it is unlikely that the client would have performed a <TT>listen</TT> to enable inbound associations. <A class="docLink" HREF="#ch23fig01">Figure 23.1</A> revisits our server code and inserts the necessary calls to make our server resistant to stale idle associations. As described in <A class="docLink" HREF="0131411551_ch07lev1sec10.html#ch07lev1sec10">Section 7.10</A>, autoclose defaults to disabled and must be explicitly enabled with the <TT>SCTP_AUTOCLOSE</TT> socket option.</P>

<H5 class="docExampleTitle"><A NAME="ch23fig01"></A>Figure 23.1 A server enabling autoclose.</H5>
<P class="docText"><span class="docEmphasis">sctp/sctpserv04.c</span></P>

<PRE>
14     if (argc == 2)
15         stream_increment = atoi(argv[1]);
16     sock_fd = Socket(AF_INET, SOCK_SEQPACKET, IPPROTO_SCTP);
17     close_time = 120;
18     Setsockopt(sock_fd, IPPROTO_SCTP, SCTP_AUTOCLOSE,
19                &amp;close_time, sizeof(close_time));

20     bzero(&amp;servaddr, sizeof(servaddr));
21     servaddr.sin_family = AF_INET;
22     servaddr.sin_addr.s_addr = htonl(INADDR_ANY);
23     servaddr.sin_port = htons(SERV_PORT);
</PRE>

<A NAME="ch23lev3sec1"></A>
<H4 class="docSection2Title"> Set autoclose option</H4>
<p class="docText"><span class="docEmphasis"><TT>17–19</TT></span> The server selects a value of 120 seconds to shut down idle associations and places this value in the variable <TT>close_time</TT>. Next, the server calls the socket option that configures the autoclose time. All the remaining code in the server stays unchanged.</p>
<P class="docText">Now, SCTP will automatically close associations that remain idle for more than two minutes. By forcing the association to close automatically, we reduce the amount of server resources consumed by lazy clients.</P>


<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch23lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch23lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
