<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="1.3 Protocol Independence"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch01lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch01lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch01lev1sec3"></A>
<H3 class="docSection1Title">1.3 Protocol Independence</H3>
<P class="docText">Our program in <A class="docLink" HREF="0131411551_ch01lev1sec2.html#ch01fig05">Figure 1.5</A> is <span class="docEmphasis">protocol-dependent</span> on IPv4. We allocate and initialize a <TT>sockaddr_in</TT> structure, we set the family of this structure to <TT>AF_INET</TT>, and we specify the first argument to <TT>socket</TT> as <TT>AF_INET</TT>.</P>
<P class="docText">To modify the program to work under IPv6, we must change the code. <A class="docLink" HREF="#ch01fig06">Figure 1.6</A> shows a version that works under IPv6, with the changes highlighted in bold.</P>

<H5 class="docExampleTitle"><A NAME="ch01fig06"></A>Figure 1.6 Version of <A class="docLink" HREF="0131411551_ch01lev1sec2.html#ch01fig05">Figure 1.5</A> for IPv6.</H5>
<P class="docText"><span class="docEmphasis">intro/daytimetcpcliv6.c</span></P>

<PRE>
 1 #include     "unp.h"

 2 int
 3 main(int argc, char **argv)
 4 {
 5     int     sockfd, n;
 6     char    recvline[MAXLINE + 1];
 7     struct <span class="docEmphStrong">sockaddr_in6</span> servaddr;

 8     if (argc != 2)
 9         err_quit("usage: a.out &lt;IPaddress&gt;");

10     if ( (sockfd = socket(<span class="docEmphStrong">AF_INET6</span>, SOCK_STREAM, 0)) &lt; 0)
11         err_sys("socket error");

12     bzero(&amp;servaddr, sizeof(servaddr));
13     servaddr.<span class="docEmphStrong">sin6_family = AF_INET6</span>;
14     servaddr.<span class="docEmphStrong">sin6_port</span> = htons(13);    /* daytime server */
15     if (inet_pton(<span class="docEmphStrong">AF_INET6</span>, argv[1], &amp;servaddr.<span class="docEmphStrong">sin6_addr</span>) &lt;= 0)
16         err_quit("inet_pton error for %s", argv[1]);

17     if (connect(sockfd, (SA *) &amp;servaddr, sizeof(servaddr)) &lt; 0)
18         err_sys("connect error");

19     while ( (n = read(sockfd, recvline, MAXLINE)) &gt; 0) {
20         recvline[n] = 0;    /* null terminate */
21         if (fputs(recvline, stdout) == EOF)
22             err_sys("fputs error");
23     }
24     if (n &lt; 0)
25         err_sys("read error");

26     exit(0);
27 }
</PRE>

<P class="docText">Only five lines are changed, but what we now have is another protocol-dependent program; this time, it is dependent on IPv6. It is better to make a program <span class="docEmphasis">protocol-independent</span>. <A class="docLink" HREF="0131411551_ch11lev1sec12.html#ch11fig11">Figure 11.11</A> will show a version of this client that is protocol-independent by using the <TT>getaddrinfo</TT> function (which is called by <TT>tcp_connect</TT>).</P>
<P class="docText">Another deficiency in our programs is that the user must enter the server's IP address as a dotted-decimal number (e.g., 206.168.112.219 for the IPv4 version). Humans work better with names instead of numbers (e.g., <TT>www.unpbook.com</TT>). In <A class="docLink" HREF="0131411551_ch11.html#ch11">Chapter 11</A>, we will discuss the functions that convert between hostnames and IP addresses, and between service names and ports. We purposely put off the discussion of these functions and continue using IP addresses and port numbers so we know exactly what goes into the socket address structures that we must fill in and examine. This also avoids complicating our discussion of network programming with the details of yet another set of functions.</P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch01lev1sec2.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch01lev1sec4.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
