<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="22.9 IPv6 Path MTU Control"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch22lev1sec8.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch22lev1sec10.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch22lev1sec9"></A>
<H3 class="docSection1Title">22.9 IPv6 Path MTU Control</H3>
<P class="docText">IPv6 gives applications several controls over path MTU discovery (<A class="docLink" HREF="0131411551_ch02lev1sec11.html#ch02lev1sec11">Section 2.11</A>). The defaults are appropriate for the vast majority of applications, but special-purpose programs may want to modify the path MTU discovery behavior. Four socket options are provided for this purpose.</P>
<A NAME="ch22lev2sec8"></A>
<H4 class="docSection2Title"> Sending with Minimum MTU</H4>
<P class="docText">When performing path MTU discovery, packets are normally fragmented using the MTU of the outgoing interface or the path MTU, whichever is smaller. IPv6 defines a minimum MTU of 1,280 bytes, which must be supported by all paths. Fragmenting to this minimum MTU wastes opportunities for sending larger packets (which is more efficient), but avoids the drawbacks of path MTU discovery (dropped packets and delay while the MTU is being discovered).</P>
<P class="docText">Two classes of applications may want to use the minimum MTU: those that use multicast (to avoid an implosion of ICMP "packet too big" messages) and those that perform brief transactions to lots of destinations (such as the DNS). Learning the MTU for a multicast session may not be important enough to pay the cost of receiving and processing millions of ICMP "packet too big" messages, and applications such as the DNS generally don't talk to the same server often enough to make it worthwhile to risk the cost of dropped packets.</P>
<P class="docText">The use of the minimum MTU is controlled with the <TT>IPV6_USE_MIN_MTU</TT> socket option. It has three defined values: -1, the default, uses the minimum MTU for multicast destinations but performs path MTU discovery to unicast destinations; 0 performs path MTU discovery to all destinations; and 1 uses the minimum MTU for all destinations.</P>
<P class="docText"><TT>IPV6_USE_MIN_MTU</TT> can also be sent as ancillary data. In the <TT>cmsghdr</TT> structure containing this ancillary data, the <TT>cmsg_level</TT> member will be <TT>IPPROTO_IPV6</TT>, the <TT>cmsg_type</TT> member will be <TT>IPV6_USE_MIN_MTU</TT>, and the first byte of data will be the first byte of the (4-byte) integer value.</P>

<A NAME="ch22lev2sec9"></A>
<H4 class="docSection2Title"> Receiving Path MTU Change Indications</H4>
<P class="docText">To receive change notifications in the path MTU, an application can enable the <TT>IPV6_RECVPATHMTU</TT> socket option. This flag enables the reception of the path MTU as ancillary data anytime it changes. <TT>recvmsg</TT> will return a zero-length datagram, but there will be ancillary data indicating the path MTU. In the <TT>cmsghdr</TT> structure containing this ancillary data, the <TT>cmsg_level</TT> member will be <TT>IPPROTO_IPV6</TT>, the <TT>cmsg_type</TT> member will be <TT>IPV6_PATHMTU</TT>, and the first byte of data will be the first byte of an <TT>ip6_mtuinfo</TT> structure. This structure contains the destination for which the path MTU has changed and the new path MTU value in bytes.</P>
<pre>

</pre><pre>
struct ip6_mtuinfo {
  struct sockaddr_in6 ip6m_addr;   /* destination address */
  uint32_t            ip6m_mtu;    /* path MTU in host byte order */
};
</pre><pre>
</pre>
<P class="docText">This structure is defined by including the <TT>&lt;netinet/in.h&gt;</TT> header.</P>

<A NAME="ch22lev2sec10"></A>
<H4 class="docSection2Title"> Determining the Current Path MTU</H4>
<P class="docText">If an application has not been keeping track with the <TT>IPV6_RECVPATHMTU</TT> option, it can determine the current path MTU of a <span class="docEmphasis">connected</span> socket with the <TT>IPV6_PATHMTU</TT> socket option. This is a get-only option, which returns an <TT>ip6_mtuinfo</TT> structure (see above) containing the current path MTU. If no path MTU has been determined, it returns the MTU of the outgoing interface. The value of the returned address is undefined.</P>

<A NAME="ch22lev2sec11"></A>
<H4 class="docSection2Title"> Avoiding Fragmentation</H4>
<P class="docText">By default, the IPv6 stack will fragment outgoing packets to the path MTU. An application such as <TT>traceroute</TT> may not want this automatic fragmentation, to discover the path MTU on its own. The <TT>IPV6_DONTFRAG</TT> socket option is used to turn off automatic fragmentation; a value of 0 (the default) permits automatic fragmentation, while a value of 1 turns off automatic fragmentation.</P>
<P class="docText">When automatic fragmentation is off, a <TT>send</TT> call providing a packet that requires fragmentation <span class="docEmphasis">may</span> return <TT>EMSGSIZE</TT>; however, the implementation is not required to provide this. The only way to determine whether a packet requires fragmentation is to use the <TT>IPV6_RECVPATHMTU</TT> option, which was already described.</P>
<P class="docText"><TT>IPV6_DONTFRAG</TT> can also be sent as ancillary data. In the <TT>cmsghdr</TT> structure containing this ancillary data, the <TT>cmsg_level</TT> member will be <TT>IPPROTO_IPV6</TT>, the <TT>cmsg_type</TT> member will be <TT>IPV6_DONTFRAG</TT>, and the first byte of data will be the first byte of the (4-byte) integer value.</P>


<a href="0131411551_23961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch22lev1sec8.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch22lev1sec10.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
