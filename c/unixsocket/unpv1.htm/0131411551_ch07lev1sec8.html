<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="7.8 IPv6 Socket Options"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch07lev1sec7.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch07lev1sec9.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch07lev1sec8"></A>
<H3 class="docSection1Title">7.8 IPv6 Socket Options</H3>
<P class="docText">These socket options are processed by IPv6 and have a <span class="docEmphasis">level</span> of <TT>IPPROTO_IPV6</TT>. We defer discussion of the multicasting socket options until <A class="docLink" HREF="0131411551_ch21lev1sec6.html#ch21lev1sec6">Section 21.6</A>. We note that many of these options make use of <span class="docEmphasis">ancillary data</span> with the <TT>recvmsg</TT> function, and we will describe this in <A class="docLink" HREF="0131411551_ch14lev1sec6.html#ch14lev1sec6">Section 14.6</A>. All the IPv6 socket options are defined in RFC 3493 [Gilligan et al. 2003] and RFC 3542 [Stevens et al. 2003].</P>
<A NAME="ch07lev2sec21"></A>
<H4 class="docSection2Title"> <TT>IPV6_CHECKSUM</TT> Socket Option</H4>
<P class="docText">This socket option specifies the byte offset into the user data where the checksum field is located. If this value is non-negative, the kernel will: (i) compute and store a checksum for all outgoing packets, and (ii) verify the received checksum on input, discarding packets with an invalid checksum. This option affects all IPv6 raw sockets, except ICMPv6 raw sockets. (The kernel always calculates and stores the checksum for ICMPv6 raw sockets.) If a value of -1 is specified (the default), the kernel will not calculate and store the checksum for outgoing packets on this raw socket and will not verify the checksum for received packets.</P>
<BLOCKQUOTE><P><P class="docList">All protocols that use IPv6 should have a checksum in their own protocol header. These checksums include a pseudoheader (RFC 2460 [Deering and Hinden 1998]) that includes the source IPv6 address as part of the checksum (which differs from all the other protocols that are normally implemented using a raw socket with IPv4). Rather than forcing the application using the raw socket to perform source address selection, the kernel will do this and then calculate and store the checksum incorporating the standard IPv6 pseudoheader.</P></P></BLOCKQUOTE>

<A NAME="ch07lev2sec22"></A>
<H4 class="docSection2Title"> <TT>IPV6_DONTFRAG</TT> Socket Option</H4>
<P class="docText">Setting this option disables the automatic insertion of a fragment header for UDP and raw sockets. When this option is set, output packets larger than the MTU of the outgoing interface will be dropped. No error needs to be returned from the system call that sends the packet, since the packet might exceed the path MTU en-route. Instead, the application should enable the <TT>IPV6_RECVPATHMTU</TT> option (<A class="docLink" HREF="0131411551_ch22lev1sec9.html#ch22lev1sec9">Section 22.9</A>) to learn about path MTU changes.</P>

<A NAME="ch07lev2sec23"></A>
<H4 class="docSection2Title"> <TT>IPV6_NEXTHOP</TT> Socket Option</H4>
<P class="docText">This option specifies the next-hop address for a datagram as a socket address structure, and is a privileged operation. We will say more about this feature in <A class="docLink" HREF="0131411551_ch22lev1sec8.html#ch22lev1sec8">Section 22.8</A>.</P>

<A NAME="ch07lev2sec24"></A>
<H4 class="docSection2Title"> <TT>IPV6_PATHMTU</TT> Socket Option</H4>
<P class="docText">This option cannot be set, only retrieved. When this option is retrieved, the current MTU as determined by path-MTU discovery is returned (see <A class="docLink" HREF="0131411551_ch22lev1sec9.html#ch22lev1sec9">Section 22.9</A>).</P>

<A NAME="ch07lev2sec25"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVDSTOPTS</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that any received IPv6 destination options are to be returned as ancillary data by <TT>recvmsg</TT>. This option defaults to OFF. We will describe the functions that are used to build and process these options in <A class="docLink" HREF="0131411551_ch27lev1sec5.html#ch27lev1sec5">Section 27.5</A>.</P>

<A NAME="ch07lev2sec26"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVHOPLIMIT</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that the received hop limit field is to be returned as ancillary data by <TT>recvmsg</TT>. This option defaults to OFF. We will describe this option in <A class="docLink" HREF="0131411551_ch22lev1sec8.html#ch22lev1sec8">Section 22.8</A>.</P>
<blockquote>
<p class="docText">There is no way with IPv4 to obtain the received TTL field.</p>
</blockquote>

<A NAME="ch07lev2sec27"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVHOPOPTS</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that any received IPv6 hop-by-hop options are to be returned as ancillary data by <TT>recvmsg</TT>. This option defaults to OFF. We will describe the functions that are used to build and process these options in <A class="docLink" HREF="0131411551_ch27lev1sec5.html#ch27lev1sec5">Section 27.5</A>.</P>

<A NAME="ch07lev2sec28"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVPATHMTU</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that the path MTU of a path is to be returned as ancillary data by <TT>recvmsg</TT> (without any accompanying data) when it changes. We will describe this option in <A class="docLink" HREF="0131411551_ch22lev1sec9.html#ch22lev1sec9">Section 22.9</A>.</P>

<A NAME="ch07lev2sec29"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVPKTINFO</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that the following two pieces of information about a received IPv6 datagram are to be returned as ancillary data by <TT>recvmsg</TT>: the destination IPv6 address and the arriving interface index. We will describe this option in <A class="docLink" HREF="0131411551_ch22lev1sec8.html#ch22lev1sec8">Section 22.8</A>.</P>

<A NAME="ch07lev2sec30"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVRTHDR</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that a received IPv6 routing header is to be returned as ancillary data by <TT>recvmsg</TT>. This option defaults to OFF. We will describe the functions that are used to build and process an IPv6 routing header in <A class="docLink" HREF="0131411551_ch27lev1sec6.html#ch27lev1sec6">Section 27.6</A>.</P>

<A NAME="ch07lev2sec31"></A>
<H4 class="docSection2Title"> <TT>IPV6_RECVTCLASS</TT> Socket Option</H4>
<P class="docText">Setting this option specifies that the received traffic class (containing the DSCP and ECN fields) is to be returned as ancillary data by <TT>recvmsg</TT>. This option defaults to OFF. We will describe this option in <A class="docLink" HREF="0131411551_ch22lev1sec8.html#ch22lev1sec8">Section 22.8</A>.</P>

<A NAME="ch07lev2sec32"></A>
<H4 class="docSection2Title"> <TT>IPV6_UNICAST_HOPS</TT> Socket Option</H4>
<P class="docText">This IPv6 option is similar to the IPv4 <TT>IP_TTL</TT> socket option. Setting the socket option specifies the default hop limit for outgoing datagrams sent on the socket, while fetching the socket option returns the value for the hop limit that the kernel will use for the socket. The actual hop limit field from a received IPv6 datagram is obtained by using the <TT>IPV6_RECVHOPLIMIT</TT> socket option. We will set this socket option with our <TT>traceroute</TT> program in <A class="docLink" HREF="0131411551_ch28lev1sec6.html#ch28fig19">Figure 28.19</A>.</P>

<A NAME="ch07lev2sec33"></A>
<H4 class="docSection2Title"> <TT>IPV6_USE_MIN_MTU</TT> Socket Option</H4>
<P class="docText">Setting this option to 1 specifies that path MTU discovery is not to be performed and that packets are sent using the minimum IPv6 MTU to avoid fragmentation. Setting it to 0 causes path MTU discovery to occur for all destinations. Setting it to–1 specifies that path MTU discovery is performed for unicast destinations but the minimum MTU is used when sending to multicast destinations. This option defaults to –1. We will describe this option in <A class="docLink" HREF="0131411551_ch22lev1sec9.html#ch22lev1sec9">Section 22.9</A>.</P>

<A NAME="ch07lev2sec34"></A>
<H4 class="docSection2Title"> <TT>IPV6_V6ONLY</TT> Socket Option</H4>
<P class="docText">Setting this option on an <TT>AF_INET6</TT> socket restricts it to IPv6 communication only. This option defaults to OFF, although some systems have an option to turn it ON by default. We will describe IPv4 and IPv6 communication using <TT>AF_INET6</TT> sockets in <A class="docLink" HREF="0131411551_ch12lev1sec2.html#ch12lev1sec2">Sections 12.2</A> and <A class="docLink" HREF="0131411551_ch12lev1sec3.html#ch12lev1sec3">12.3</A>.</P>

<A NAME="ch07lev2sec35"></A>
<H4 class="docSection2Title"> <TT>IPV6_XXX</TT> Socket Options</H4>
<P class="docText">Most of the IPv6 options for header modification assume a UDP socket with information being passed between the kernel and the application using ancillary data with <TT>recvmsg</TT> and <TT>sendmsg</TT>. A TCP socket fetches and stores these values using <TT>getsockopt</TT> and <TT>setsockopt</TT> instead. The socket option is the same as the type of the ancillary data, and the buffer contains the same information as would be present in the ancillary data. We will describe this in <A class="docLink" HREF="0131411551_ch27lev1sec7.html#ch27lev1sec7">Section 27.7</A>.</P>


<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch07lev1sec7.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch07lev1sec9.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
