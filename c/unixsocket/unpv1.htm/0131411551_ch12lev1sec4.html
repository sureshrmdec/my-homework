<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.4 IPv6 Address-Testing Macros"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131411551_ch12lev1sec3.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131411551_ch12lev1sec5.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch12lev1sec4"></A>
<H3 class="docSection1Title">12.4 IPv6 Address-Testing Macros</H3>
<P class="docText">There is a small class of IPv6 applications that must know whether they are talking to an IPv4 peer. These applications need to know if the peer's address is an IPv4-mapped IPv6 address. The following 12 macros are defined to test an IPv6 address for certain properties.</P>
<P><TABLE CELLSPACING="0" BORDER="1" RULES="none" CELLPADDING="5" WIDTH="100%"><COLGROUP align="left" span="1"><THEAD></THEAD><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>#include &lt;netinet/in.h&gt;</TT></P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_UNSPECIFIED(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_LOOPBACK(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MULTICAST(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_LINKLOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_SITELOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_V4MAPPED(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_V4COMPAT(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MC_NODELOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MC_LINKLOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MC_SITELOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MC_ORGLOCAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" valign="top"><P class="docText"><TT>int IN6_IS_ADDR_MC_GLOBAL(const struct in6_addr</TT> *<span class="docEmphasis">aptr</span><TT>)</TT>;</P></TD></TR><TR><TD class="docTableCell" align="right" valign="top"><P class="docText">All return: nonzero if IPv6 address is of specified type, zero otherwise</P></TD></TR></COLGROUP></TABLE></P>
<P class="docText">The first seven macros test the basic type of IPv6 address. We show these various address types in <A class="docLink" HREF="0131411551_app01lev1sec5.html#app01lev1sec5">Section A.5</A>. The final five macros test the scope of an IPv6 multicast address (<A class="docLink" HREF="0131411551_ch21lev1sec2.html#ch21lev1sec2">Section 21.2</A>).</P>
<BLOCKQUOTE><P><P class="docList">IPv4-compatible addresses are used by a transition mechanism that has fallen out of favor. You're not likely to actually see this type of address or need to test for it.</P></P></BLOCKQUOTE>
<P class="docText">An IPv6 client could call the <TT>IN6_IS_ADDR_V4MAPPED</TT> macro to test the IPv6 address returned by the resolver. An IPv6 server could call this macro to test the IPv6 address returned by <TT>accept</TT> or <TT>recvfrom</TT>.</P>
<P class="docText">As an example of an application that needs this macro, consider FTP and its <TT>PORT</TT> command. If we start an FTP client, log in to an FTP server, and issue an FTP <TT>dir</TT> command, the FTP client sends a <TT>PORT</TT> command to the FTP server across the control connection. This tells the server the client's IP address and port, to which the server then creates a data connection. (Chapter 27 of TCPv1 contains all the details of the FTP application protocol.) But, an IPv6 FTP client must know whether the server is an IPv4 server or an IPv6 server, because the former requires a command of the form <TT>PORT a1</TT>,<TT>a2</TT>,<TT>a3</TT>,<TT>a4</TT>,<TT>p1</TT>,<TT>p2</TT> where the first four numbers (each between 0 and 255) form the 4-byte IPv4 address and the last two numbers form the 2-byte port number. An IPv6 server, however, requires an <TT>EPRT</TT> command (RFC 2428 [Allman, Ostermann, and Metz 1998]), containing an address family, text format address, and text format port. <A class="docLink" HREF="0131411551_ch12lev1sec7.html#ch12lev1sec7">Exercise 12.1</A> gives an example of IPv4 and IPv6 FTP protocol behavior.</P>

<a href="0131411551_22961534.html"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131411551_ch12lev1sec3.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131411551_ch12lev1sec5.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
